# 目的（Purpose）

## CFD で得られた二次元風車後流データ（x, r, u, k, ω, nut）に基づき、速度欠損 ΔU(x, r) を表す“代数式モデル（Algebraic Wake Model）”を、自動的に探索・発見すること

- 既存の wake モデル（Jensen、Bastankhah、Gaussian など）が持つ限界
- 乱流・渦粘性・乱流量 k, ω の後流構造への影響
- 個別ケースに合わせた高速 surrogate モデルの需要
   を解決するための、**データ駆動・物理融合の式探索**

AutoTurb の思想を踏襲しつつ、
 **LLM + 進化計算 + 物理性ペナルティ + DE（係数最適化） + 自己改善**
 という、既存研究を超える新しい Equation Discovery フレームワークを構築

------

# 方法（Method）

本フレームワークの特徴は、
 **LLM と Julia によるハイブリッド構造探索（symbolic structure search）** 

全体フローは次の5段階で構成

------

## ① 構造式生成（LLM）

LLM は、後流モデルの候補式
$$
\Delta U_{\text{model}}(x,r,k,\omega,nut)= f(x, r, k, \omega, nut; a,b,c,\dots)
$$
を **Julia の symbolic expression（構造のみ）** として生成します。
 係数 a,b,c,… は記号のまま残し、数値は決めません。

### 使用可能な構造例：

- exp(-b*x)（x方向減衰）
- (1 + c*r^2)^(-d)（横方向拡散）
- nut や k, ω を含んだ乱流依存項
- 多項式、対数、指数、乗算組み合わせ

Python 式は禁止し、Julia 形式に統一。

------

## ② 係数最適化（Julia + DE）

LLM が生成した構造式に対し、
 Julia 側で **Differential Evolution (DE)** による係数最適化を行います。

- 探索範囲は log-uniform（1e-4〜1e2）
- DE パラメータ：NP=30, F=0.7, CR=0.9
- 評価値 = MSE(ΔU_model − ΔU_data)

これにより、構造式の性能を正確に評価可能。

------
<!-->

## ③ 物理性ペナルティによる制約（Phase 6）

評価関数に
$$
\text{Score} = \text{MSE} + P_1 + P_2 + P_3 + P_4
$$
を導入。

### ペナルティ内容：

- **P1**：x 方向の減衰性（wake recovery）
- **P2**：r 方向の対称性
- **P3**：非物理的な ΔU（負、過大）
- **P4**：nut / k / ω に反する拡散挙動

これにより、
 **精度は高いが非物理的**な式を排除できます。

------

## ④ 進化計算（EP1〜EP4）

20世代 × 20個体の進化計算を行います。

### EP（Evolutionary Prompts）：

- **EP1**：多様性生成
- **EP2**：局所改善
- **EP3**：物理性改善（P1〜P4 を改善する構造を導入）
- **EP4**：簡素化・縮約

LLM は常に

- 新しい構造式
- Reason（構造変更の理由）

を生成します。

------

## ⑤ Reflective Evolution（Phase 7：自己改善）

Phase 7 では、LLM が

- 各世代の Reason
- 物理性ペナルティ P1〜P4 の傾向
- 精度悪化原因
- 過剰複雑化の指標

を読み取り、
 **Reflection（反省） → Action Items（次世代の改善方針）**
 を自律的に生成します。

次世代ではこの Action Items を組み込んで、
 構造式の生成方針（EP の選択）を自動調整します。

これにより、
 **“LLM が自らの生成行動を学習して進化する”**
 という新しい形の探索が実現します。
-->
------

# まとめ：このプロジェクトの特徴

------

### ✔ データ（CFD） × 物理性 × LLM × Evolutionary Search の融合

既存のサロゲートやガウスモデルを超える
 **データ駆動・物理融合型の式探索**。

------

### ✔ LLM は構造式のみ生成 → Julia が高速評価

役割分担が明確で効率が高い。

------

### ✔ 係数はすべて DE に任せる → 安定性・精度が向上

symbolic regression の定石に沿った構成。

------

### ✔ 物理性ペナルティ（P1〜P4）を導入し、

**非物理的モデルを自動排除**。

------
<!-->
### ✔ Phase7 は Reason を反省材料として探索を改善

論文級の新規性がある
 **自己改善型の式探索**。
-->
------

## ✔ 風車後流（wake）の実データに完全対応

CSV → evaluator → DE → LLM の循環が実現。

------

# 🧭 **最終的に得られるもの**

- 後流の速度欠損 ΔU(x,r) を精度よく・物理的に記述する代数式
- 乱流量 k, ω、渦粘性 nut の効果を含む新しい wake モデル
- 既存モデル（Gaussian, Bastankhah等）より高精度な surrogate
- 物理的一貫性のある式（r 対称性、x 減衰性など）
- 探索プロセスの Reason/Reflection の記録