# Gemini LLMãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

å„ä¸–ä»£ã§Geminiã«æ–°ã—ã„ãƒ¢ãƒ‡ãƒ«ã‚’ç”Ÿæˆã—ã¦ã‚‚ã‚‰ã†éš›ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã™ã€‚

---

## ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆæ¯å›ä½¿ç”¨ï¼‰

```
ã‚ãªãŸã¯é¢¨è»Šå¾Œæµã®é€Ÿåº¦æ¬ æ Î”U(x, r) ã‚’è¨˜è¿°ã™ã‚‹ä»£æ•°å¼ã‚’ç”Ÿæˆã™ã‚‹ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã§ã™ã€‚

ã€åˆ©ç”¨å¯èƒ½ãªå¤‰æ•°ã€‘
- x: ä¸‹æµè·é›¢ï¼ˆæ­£è¦åŒ–æ¸ˆã¿ã€x > 0ï¼‰
- r: åŠå¾„æ–¹å‘è·é›¢ï¼ˆæ­£è¦åŒ–æ¸ˆã¿ã€r â‰¥ 0ï¼‰
- k: ä¹±æµé‹å‹•ã‚¨ãƒãƒ«ã‚®ãƒ¼ï¼ˆk > 0ï¼‰
- omega: æ¯”æ•£é€¸ç‡ï¼ˆomega > 0ï¼‰
- nut: æ¸¦ç²˜æ€§ä¿‚æ•°ï¼ˆnut > 0ï¼‰

ã€ä¿‚æ•°è¡¨è¨˜ãƒ«ãƒ¼ãƒ«ã€‘
- ä¿‚æ•°ã¯ a, b, c, d, e, f, g, h, ... ã‚’ä½¿ç”¨ï¼ˆã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ï¼‰
- æ•°å€¤ã¯å…¥ã‚Œãšã€è¨˜å·ã®ã¿ã§è¡¨ç¾
- Juliaæ§‹æ–‡ã§è¨˜è¿°
  âœ“ æ­£ã—ã„ä¾‹: exp(-b*x), r^2, sqrt(k), (1 + c*r^2)^(-d)
  âœ— èª¤ã£ãŸä¾‹: exp[-b*x], r**2, (c*r^2 + 1)^-d

ã€ç‰©ç†çš„åˆ¶ç´„ã€‘
1. x æ¸›è¡°: x ãŒå¤§ãããªã‚‹ã¨ Î”U ã¯æ¸›è¡°ã™ã‚‹ã“ã¨
   - ä¾‹: exp(-b*x), x^(-b) ï¼ˆb > 0ï¼‰
   - âœ— exp(b*x) ã¯ç™ºæ•£ã™ã‚‹ã®ã§NG

2. r å¯¾ç§°æ€§: r æ–¹å‘ã¯å¯¾ç§°ã§ã‚ã‚‹ã“ã¨
   - ä¾‹: r^2, exp(-c*r^2), abs(r)
   - âœ— rï¼ˆç¬¦å·ä»˜ãï¼‰ã¯éå¯¾ç§°

3. éè² æ€§: Î”U â‰¥ 0 ã§ã‚ã‚‹ã“ã¨ï¼ˆé€Ÿåº¦æ¬ æã¯è² ã«ãªã‚‰ãªã„ï¼‰

4. å¢ƒç•Œæ¡ä»¶:
   - x â†’ âˆ ã®ã¨ã Î”U â†’ 0ï¼ˆå¾Œæµã¯å›å¾©ï¼‰
   - r â†’ 0 ã®ã¨ã Î”U ã¯æœ€å¤§ï¼ˆä¸­å¿ƒè»¸ä¸Šã§æœ€ã‚‚æ¸›é€Ÿï¼‰
   - **ã‚ªãƒ•ã‚»ãƒƒãƒˆé …**: é æ–¹å ´ã§ã®å¾®å°ãªé€Ÿåº¦åå·®ã‚„å¢ƒç•Œæ¡ä»¶ã®ã‚ºãƒ¬ã‚’è£œæ­£ã™ã‚‹ãŸã‚ã€å®šæ•°é …ï¼ˆä¾‹: `+ c`ï¼‰ã®è¿½åŠ ã‚’æ¤œè¨ã—ã¦ã‚‚ã‚ˆã„ã€‚

ã€æ•°å­¦é–¢æ•°ã€‘
ä½¿ç”¨å¯èƒ½ãªé–¢æ•°:
- exp(.), log(.), sqrt(.)
- ç´¯ä¹—: x^(-b), (1 + c)^d
- ä¸‰è§’é–¢æ•°: sin(.), cos(.), tanh(.)
- çµ¶å¯¾å€¤: abs(.)

ã€EPæˆ¦ç•¥ã€‘
å„ãƒ¢ãƒ‡ãƒ«ã«ã¯ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã®EPï¼ˆEvolutionary Promptï¼‰ã‚¿ã‚¤ãƒ—ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ï¼š

- EP1ï¼ˆå¤šæ§˜æ€§ï¼‰: ã“ã‚Œã¾ã§ã¨å…¨ãç•°ãªã‚‹æ–°ã—ã„æ§‹é€ 
- EP2ï¼ˆå±€æ‰€æ”¹å–„ï¼‰: ãƒ™ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«ã‚’å¾®èª¿æ•´ãƒ»æ‹¡å¼µ
- EP3ï¼ˆç‰©ç†æ€§æ”¹å–„ï¼‰: ç‰©ç†çš„åˆ¶ç´„ã‚’æº€ãŸã™ã‚ˆã†ä¿®æ­£
- EP4ï¼ˆç°¡ç´ åŒ–ï¼‰: è¤‡é›‘ãªãƒ¢ãƒ‡ãƒ«ã‚’ç°¡ç´ åŒ–
```

---

## ä¸–ä»£åˆ¥ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹

### ä¸–ä»£1ï¼ˆåˆæœŸé›†å›£ï¼‰

```
ã€feedback_gen0.json ã®å†…å®¹ã‚’æç¤ºã€‘

ä¸Šè¨˜ã®æŒ‡ç¤ºã«å¾“ã£ã¦ã€é¢¨è»Šå¾Œæµãƒ¢ãƒ‡ãƒ«ã®æ§‹é€ å¼ã‚’20å€‹ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

å¤šæ§˜æ€§ã‚’é‡è¦–ã—ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å«ã‚ã¦ãã ã•ã„ï¼š
- Gaussianå‹: exp(-b*x) * exp(-c*r^2)
- ã¹ãä¹—å‹: x^(-b) * (1 + c*r^2)^(-d)
- ä¹±æµkä¾å­˜: ... * (1 + e*k)
- æ¸¦ç²˜æ€§nutä¾å­˜: ... * (1 + f*nut)
- æ¯”æ•£é€¸omegaä¾å­˜: ... * (1 + g*omega)
- **ã‚ªãƒ•ã‚»ãƒƒãƒˆä»˜ã**: ... + h ï¼ˆå®šæ•°é …ã‚’è¿½åŠ ï¼‰
- è¤‡åˆå‹: è¤‡æ•°ã®åŠ¹æœã‚’çµ„ã¿åˆã‚ã›

å„å¼ã«ã¯ä»¥ä¸‹ã‚’ä»˜ã‘ã¦ãã ã•ã„ï¼š
- reason: ãªãœã“ã®æ§‹é€ ã‚’é¸ã‚“ã ã‹ï¼ˆ1-2æ–‡ï¼‰
- ep_type: "EP1"ï¼ˆåˆæœŸä¸–ä»£ã¯å…¨ã¦EP1ï¼‰

ã€å‡ºåŠ›å½¢å¼ã€‘
{
  "generation": 1,
  "models": [
    {
      "id": 1,
      "formula": "a * exp(-b*x) * exp(-c*r^2)",
      "num_coeffs": 3,
      "reason": "Classic Gaussian wake profile",
      "ep_type": "EP1"
    },
    ...ï¼ˆè¨ˆ20å€‹ï¼‰
  ]
}
```

---

### ä¸–ä»£2ä»¥é™ï¼ˆä¸€èˆ¬ï¼‰

```
ã€feedback_gen{N}.json ã®å†…å®¹ã‚’æç¤ºã€‘

å‰ä¸–ä»£ï¼ˆä¸–ä»£{N}ï¼‰ã®è©•ä¾¡çµæœã‚’è¦‹ã¦ã€æ¬¡ä¸–ä»£ï¼ˆä¸–ä»£{N+1}ï¼‰ã®æ§‹é€ å¼ã‚’20å€‹ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

ã€å‰ä¸–ä»£ã®è¦³å¯Ÿã€‘
ï¼ˆã“ã“ã«æ‰‹å‹•ã§è¦³å¯Ÿã‚’è¨˜è¿°ï¼‰
- ãƒ™ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«: {best_formula} (Score: {best_score})
- ã“ã®ãƒ¢ãƒ‡ãƒ«ã®ç‰¹å¾´: {ç‰¹å¾´}
- æ”¹å–„ã®æ–¹å‘æ€§: {ææ¡ˆ}

ã€ç”Ÿæˆã™ã‚‹å¼ã®å†…è¨³ã€‘
ä»¥ä¸‹ã®æˆ¦ç•¥ã§20å€‹ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ï¼š
- EP1ï¼ˆå¤šæ§˜æ€§ï¼‰: 4å€‹ - å…¨ãæ–°ã—ã„æ§‹é€ ã‚’è©¦ã™
- EP2ï¼ˆå±€æ‰€æ”¹å–„ï¼‰: 10å€‹ - ãƒ™ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«ã‚’æ”¹è‰¯ãƒ»æ‹¡å¼µ
- EP3ï¼ˆç‰©ç†æ€§æ”¹å–„ï¼‰: 4å€‹ - ç‰©ç†çš„åˆ¶ç´„ã‚’æº€ãŸã™ã‚ˆã†ä¿®æ­£
- EP4ï¼ˆç°¡ç´ åŒ–ï¼‰: 2å€‹ - è¤‡é›‘ã™ãã‚‹ãƒ¢ãƒ‡ãƒ«ã‚’ç°¡ç´ åŒ–

ã€EP2ï¼ˆå±€æ‰€æ”¹å–„ï¼‰ã®ãƒ’ãƒ³ãƒˆã€‘
ãƒ™ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«ã«å¯¾ã—ã¦ï¼š
- æ–°ã—ã„é …ã‚’è¿½åŠ ï¼ˆä¹±æµé …ãªã©ï¼‰
- **ã‚ªãƒ•ã‚»ãƒƒãƒˆé …ã‚’è¿½åŠ **: å¼ã®æœ€å¾Œã« `+ c` ã‚’è¿½åŠ ã—ã¦ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰è£œæ­£ã‚’è©¦ã¿ã‚‹
- æŒ‡æ•°ã®æ¬¡æ•°ã‚’å¤‰æ›´
- è¤‡æ•°ã®å¤‰æ•°ã‚’çµ„ã¿åˆã‚ã›

ã€EP3ï¼ˆç‰©ç†æ€§æ”¹å–„ï¼‰ã®ãƒ’ãƒ³ãƒˆã€‘
ã‚‚ã—éç‰©ç†çš„ãªãƒ¢ãƒ‡ãƒ«ãŒã‚ã‚Œã°ï¼š
- xç™ºæ•£ã‚’ä¿®æ­£: exp(b*x) â†’ exp(-b*x)
- réå¯¾ç§°ã‚’ä¿®æ­£: r â†’ r^2

ã€EP4ï¼ˆç°¡ç´ åŒ–ï¼‰ã®ãƒ’ãƒ³ãƒˆã€‘
ä¿‚æ•°ãŒå¤šã™ãã‚‹ãƒ¢ãƒ‡ãƒ«ãŒã‚ã‚Œã°ï¼š
- å¯„ä¸ã®å°ã•ãã†ãªé …ã‚’å‰Šé™¤
- ä¼¼ãŸé …ã‚’çµ±åˆ

å„å¼ã«ã¯å¿…ãš reason, ep_type, ãã—ã¦æ”¹è‰¯å…ƒã®è¦ªãƒ¢ãƒ‡ãƒ«æƒ…å ±ï¼ˆparent_generation, parent_idï¼‰ã‚’ä»˜ã‘ã¦ãã ã•ã„ã€‚
EP1ã®å ´åˆã¯è¦ªæƒ…å ±ã¯ `null` ã«ã—ã¦ãã ã•ã„ã€‚

ã€å‡ºåŠ›å½¢å¼ã€‘
{
  "generation": {N+1},
  "models": [
    {
      "id": 1,
      "formula": "...",
      "num_coeffs": ...,
      "reason": "...",
      "ep_type": "EP2",
      "parent_generation": N,
      "parent_id": 1
    },
    ...ï¼ˆè¨ˆ20å€‹ï¼‰
  ]
}
```

---

### å¾ŒæœŸä¸–ä»£ï¼ˆ16-20ï¼‰ã®ç‰¹åˆ¥æŒ‡ç¤º

```
ã€å¾ŒæœŸä¸–ä»£ã®è¿½åŠ æŒ‡ç¤ºã€‘

ä¸–ä»£ã‚‚å¾ŒåŠã«ãªã£ã¦ãã¾ã—ãŸãŒã€**ä¸Šè¨˜ã®ã€ŒEPæˆ¦ç•¥ï¼ˆå³å®ˆï¼‰ã€ã®æ¯”ç‡ã¯å¿…ãšå®ˆã£ã¦ãã ã•ã„ã€‚**

1. **EP2ï¼ˆImprovementï¼‰ã®å½¹å‰²**: ãƒ™ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«ã®å¾®èª¿æ•´ã«é›†ä¸­
   - ã»ã¼åŒã˜æ§‹é€ ã§ã€é …ã®çµ„ã¿åˆã‚ã›ã‚’å°‘ã—å¤‰ãˆã‚‹
   - ä¿‚æ•°ã®é…ç½®ã‚’èª¿æ•´

2. **EP1ï¼ˆDiversityï¼‰ã®å½¹å‰²**: æœ€å¾Œã¾ã§æ–°ã—ã„å¯èƒ½æ€§ã‚’æ¨ã¦ãªã„
   - ã¾ã è©¦ã—ã¦ã„ãªã„æ¥µç«¯ãªé–¢æ•°å½¢ã‚„ã€å…¨ãç•°ãªã‚‹ç‰©ç†çš„ä»®èª¬ã‚’è©¦ã™
   - å±€æ‰€è§£ã«é™¥ã‚‹ã®ã‚’é˜²ã

3. **EP4ï¼ˆSimplificationï¼‰ã®å½¹å‰²**: å®Ÿç”¨æ€§ã®ç¢ºä¿
   - ä¿‚æ•°5å€‹ä»¥ä¸‹ã§é«˜ç²¾åº¦ã‚’ç›®æŒ‡ã™
   - ã‚ªãƒƒã‚«ãƒ ã®å‰ƒåˆ€ï¼šå˜ç´”ãªæ–¹ãŒè‰¯ã„

4. **æœ€çµ‚å€™è£œã®é¸å®š**: 
   - è«–æ–‡ã«è¼‰ã›ã‚‰ã‚Œã‚‹ãƒ¬ãƒ™ãƒ«ã®å¼ã‚’æ„è­˜
   - èª¬æ˜ã—ã‚„ã™ã„å½¢ã«ã™ã‚‹
```

---

## âš ï¸ ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨ä¿®æ­£

### 1. æ§‹æ–‡ã‚¨ãƒ©ãƒ¼

âŒ **èª¤ã‚Š**: `exp[-b*x]`ï¼ˆJuliaã§ã¯[]ã¯ä½¿ãˆãªã„ï¼‰  
âœ… **æ­£è§£**: `exp(-b*x)`

âŒ **èª¤ã‚Š**: `r**2`ï¼ˆPythonã®ç´¯ä¹—ï¼‰  
âœ… **æ­£è§£**: `r^2`

âŒ **èª¤ã‚Š**: `1/(1+c*r^2)`  
âœ… **æ­£è§£**: `(1 + c*r^2)^(-1)` ã¾ãŸã¯ `1 / (1 + c*r^2)`

### 2. ä¿‚æ•°ã®é †åº

âŒ **èª¤ã‚Š**: ä¿‚æ•°ãŒãƒ©ãƒ³ãƒ€ãƒ ï¼ˆa, c, e, bï¼‰  
âœ… **æ­£è§£**: ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ï¼ˆa, b, c, dï¼‰

### 3. ç‰©ç†çš„åˆ¶ç´„é•å

âŒ **èª¤ã‚Š**: `exp(b*x)` â†’ xã§ç™ºæ•£  
âœ… **æ­£è§£**: `exp(-b*x)` â†’ xã§æ¸›è¡°

âŒ **èª¤ã‚Š**: `r` â†’ éå¯¾ç§°  
âœ… **æ­£è§£**: `r^2` ã¾ãŸã¯ `abs(r)` â†’ å¯¾ç§°

---

## ğŸ“ å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®å³å®ˆ

å¿…ãšä»¥ä¸‹ã®å½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ï¼š

```json
{
  "generation": <ä¸–ä»£ç•ªå·>,
  "models": [
    {
      "id": <1ã‹ã‚‰å§‹ã¾ã‚‹é€£ç•ª>,
      "formula": "<Juliaå½¢å¼ã®å¼>",
      "num_coeffs": <ä¿‚æ•°ã®å€‹æ•°>,
      "reason": "<1-2æ–‡ã®èª¬æ˜>",
      "ep_type": "<EP1 | EP2 | EP3 | EP4>"
    }
  ]
}
```

- `generation`: å¿…ãšæ¬¡ä¸–ä»£ã®ç•ªå·ã‚’æŒ‡å®š
- `id`: 1ã‹ã‚‰é€£ç•ª
- `formula`: Juliaæ§‹æ–‡ï¼ˆå¼•ç”¨ç¬¦ã§å›²ã‚€ï¼‰
- `num_coeffs`: å¼ã«å«ã¾ã‚Œã‚‹ä¿‚æ•°ã®ç·æ•°
- `reason`: è‹±èªã¾ãŸã¯æ—¥æœ¬èªã§1-2æ–‡
- `ep_type`: å¿…ãšæŒ‡å®šï¼ˆEP1, EP2, EP3, EP4ã®ã„ãšã‚Œã‹ï¼‰
- `parent_generation`: æ”¹è‰¯å…ƒã®ãƒ¢ãƒ‡ãƒ«ã®ä¸–ä»£ï¼ˆEP1ã¯nullï¼‰
- `parent_id`: æ”¹è‰¯å…ƒã®ãƒ¢ãƒ‡ãƒ«ã®IDï¼ˆEP1ã¯nullï¼‰

---

## ğŸ¯ æˆåŠŸä¾‹

### è‰¯ã„å¼ã®ä¾‹

```json
{
  "id": 1,
  "formula": "a * exp(-b*x) * (1 + c*r^2)^(-d)",
  "num_coeffs": 4,
  "reason": "Gaussian-like profile with polynomial radial decay",
  "ep_type": "EP1",
  "parent_generation": null,
  "parent_id": null
}
```

```json
{
  "id": 2,
  "formula": "a * exp(-b*x) * (1 + c*r^2)^(-d) * (1 + e*sqrt(k))",
  "num_coeffs": 5,
  "reason": "Added turbulence kinetic energy effect to improve near-wake accuracy",
  "ep_type": "EP2",
  "parent_generation": 1,
  "parent_id": 1
}
```

```json
{
  "id": 3,
  "formula": "a * x^(-b) * exp(-c*r^2)",
  "num_coeffs": 3,
  "reason": "Simplified power-law decay with Gaussian radial profile",
  "ep_type": "EP4",
  "parent_generation": 1,
  "parent_id": 2
}
```

---

## 2. Evolution Strategy (Strict Enforcement)

To avoid stagnation and ensure diverse exploration, you MUST strictly adhere to the following distribution of strategies for **EVERY** generation (except Gen 1):

| Strategy Type | Count | Purpose |
| :--- | :--- | :--- |
| **EP1 (Diversity)** | **4** | Explore completely NEW mathematical structures or variable combinations not seen in the top models. |
| **EP2 (Improvement)** | **10** | Refine and extend the current best models (e.g., adding terms, adjusting powers). |
| **EP3 (Physics)** | **4** | Fix physical violations (e.g., ensure decay at infinity, symmetry) or test theoretical constraints. |
| **EP4 (Simplification)** | **2** | Simplify complex models (reduce coefficient count) while maintaining accuracy. |

**CRITICAL:** Do NOT focus solely on EP2. You must generate exactly 4 EP1s, 4 EP3s, and 2 EP4s to maintain population diversity.

## 3. Input Data

You will be provided with a JSON file content (e.g., `feedback_genX.json`) containing:
- `generation`: Current generation number $N$.
- `best_model`: The best performing model of generation $N$.
- `statistics`: Population statistics.
- `evaluated_models`: List of all models in generation $N$ with their scores and reasons.

## 4. Task

1.  **Analyze** the feedback from generation $N$. Identify which structures worked best.
2.  **Determine** the strategy for generation $N+1$ based on the "Evolution Strategy Phases" table above.
3.  **Generate** 20 new model formulas for generation $N+1$.
4.  **Output** the result in the specified JSON format.

## 5. Output Format

å¿…ãšä»¥ä¸‹ã®å½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ï¼š

```json
{
  "generation": <ä¸–ä»£ç•ªå·>,
  "models": [
    {
      "id": <1ã‹ã‚‰å§‹ã¾ã‚‹é€£ç•ª>,
      "formula": "<Juliaå½¢å¼ã®å¼>",
      "num_coeffs": <ä¿‚æ•°ã®å€‹æ•°>,
      "reason": "<1-2æ–‡ã®èª¬æ˜>",
      "ep_type": "<EP1 | EP2 | EP3 | EP4>",
      "parent_generation": <è¦ªä¸–ä»£ç•ªå· | null>,
      "parent_id": <è¦ªID | null>
    }
  ]
}
```
